# Радиогоризонт НСУ БпЛА

## Назначение

Карта радиогоризонта показывает зоны **прямой радиовидимости** между наземной станцией управления (НСУ) и беспилотным летательным аппаратом (БпЛА) с учётом рельефа местности и кривизны Земли.

Зелёная зона — БпЛА виден из точки НСУ. Красная зона — рельеф перекрывает прямую видимость.

## Физическая модель

### Прямая видимость (LOS)

Для каждой точки карты строится луч от НСУ до БпЛА и проверяется, не пересекает ли он поверхность рельефа. Учитывается кривизна Земли через поправку:

$$\Delta h = \frac{d^2}{2 R_e}$$

где:
- $\Delta h$ — поправка за кривизну Земли (м)
- $d$ — расстояние до точки (м)
- $R_e$ — эффективный радиус Земли (м)

### Эффективный радиус Земли

Для учёта стандартной рефракции радиоволн в атмосфере используется эффективный радиус:

$$R_e = k \cdot R_0$$

где $R_0 = 6\,371\,000$ м — средний радиус Земли, $k = 4/3$ — коэффициент стандартной рефракции.

Таким образом:

$$R_e = \frac{4}{3} \cdot 6\,371\,000 \approx 8\,495\,000 \text{ м}$$

### Алгоритм проверки видимости

Для каждого направления от НСУ строится профиль рельефа. Точка считается **видимой**, если ни одна промежуточная точка рельефа (с учётом кривизны Земли) не поднимается выше луча:

$$h_{terrain}(d_i) + \Delta h(d_i) < h_{los}(d_i)$$

где $h_{los}(d_i)$ — высота луча прямой видимости на расстоянии $d_i$.

## Режимы высоты БпЛА

| Режим | Описание |
|-------|----------|
| **От уровня КТ** | Высота БпЛА отсчитывается от уровня контрольной точки (НСУ) |
| **От земли** | Высота БпЛА отсчитывается от поверхности земли в каждой точке (AGL) |
| **От уровня моря** | Абсолютная высота БпЛА (AMSL) |

## Использование

1. Установите контрольную точку (правый клик на карте)
2. Выберите тип карты «Радиогоризонт НСУ БпЛА»
3. Задайте высоту БпЛА (метры)
4. Выберите режим отсчёта высоты
5. Нажмите **Создать карту**

### Alpha-слайдер

Слайдер прозрачности позволяет регулировать наложение карты радиогоризонта поверх спутникового снимка. При изменении положения слайдера карта перерисовывается в реальном времени без повторной загрузки данных.

## Данные рельефа

Данные высот загружаются из Mapbox Terrain-RGB (формат Terrain-RGB):

$$h = -10000 + 0.1 \cdot (R \cdot 256^2 + G \cdot 256 + B)$$

где $R$, $G$, $B$ — значения каналов пикселя тайла.

Нативное разрешение Mapbox Terrain-RGB — zoom 14 (~5 м/пиксель на экваторе).
